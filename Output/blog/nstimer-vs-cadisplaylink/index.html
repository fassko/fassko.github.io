<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Kristaps Grinbergs"/><link rel="canonical" href="https://kristaps.me/blog/nstimer-vs-cadisplaylink"/><meta name="twitter:url" content="https://kristaps.me/blog/nstimer-vs-cadisplaylink"/><meta name="og:url" content="https://kristaps.me/blog/nstimer-vs-cadisplaylink"/><title>NSTimer vs CADisplayLink | Kristaps Grinbergs</title><meta name="twitter:title" content="NSTimer vs CADisplayLink | Kristaps Grinbergs"/><meta name="og:title" content="NSTimer vs CADisplayLink | Kristaps Grinbergs"/><meta name="description" content="`NSTimer` or just `Timer` in Swift world is a commonly used way to execute something repeatedly with an interval. For instance, a countdown timer is a perfect example. A hidden gem is `CADisplayLink` - a special flavor of timer that is linked to the device screen refresh rate. Usually, it is 60 frames per second, but in new iPads, it is 120 frames per second."/><meta name="twitter:description" content="`NSTimer` or just `Timer` in Swift world is a commonly used way to execute something repeatedly with an interval. For instance, a countdown timer is a perfect example. A hidden gem is `CADisplayLink` - a special flavor of timer that is linked to the device screen refresh rate. Usually, it is 60 frames per second, but in new iPads, it is 120 frames per second."/><meta name="og:description" content="`NSTimer` or just `Timer` in Swift world is a commonly used way to execute something repeatedly with an interval. For instance, a countdown timer is a perfect example. A hidden gem is `CADisplayLink` - a special flavor of timer that is linked to the device screen refresh rate. Usually, it is 60 frames per second, but in new iPads, it is 120 frames per second."/><meta name="og:site_name" content="Kristaps Grinbergs - iOS and Apple technology developer. Startup founder. Conference speaker."/><meta name="og:title" content="Kristaps Grinbergs - iOS and Apple technology developer. Startup founder. Conference speaker."/><meta name="og:description" content="Kristaps Grinbergs - iOS and Apple technology developer. Startup founder. Conference speaker."/><meta name="og:image" content="linkedin.png"/><meta name="og:type" content="website"/><meta name="og:url" content="https://kristaps.me"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@fassko"/><meta name="twitter:title" content="Kristaps Grinbergs"/><meta name="twitter:description" content="Kristaps Grinbergs - iOS and Apple technology developer. Startup founder. Conference speaker."/><meta name="twitter:image" content="fb-og.png"/><link href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet"/><link rel="apple-touch-icon-precomposed" sizes="120x120" href="apple-touch-icon-120x120.png"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Kristaps Grinbergs"/></head><body><header class="header"><div class="header-wrapper"><div class="main-title"><a href="/">Kristaps Grinbergs</a></div><nav class="nav-container"><nav><ul class="nav"><li class="nav-item"><a href="/">home</a></li><li class="nav-item"><a href="/blog">blog</a></li><li class="nav-item"><a href="/talks">talks</a></li><li class="nav-item"><a href="/about">about</a></li></ul></nav></nav></div></header><div class="wrapper"><section class="blog-list"><div class="blog-item"><h1 class="blog-title">NSTimer vs CADisplayLink</h1><div class="blog-date">27 Mar 2020</div><div class="blog-content"><p><code>NSTimer</code> or just <code>Timer</code> in Swift world is a commonly used way to execute something repeatedly with an interval. For instance, a countdown timer is a perfect example.</p><p>A hidden gem is <code>CADisplayLink</code> - a special flavor of timer that is linked to the device screen refresh rate. Usually, it is 60 frames per second, but in new iPads, it is 120 frames per second.</p><h2>What is (NS)Timer?</h2><p>With <a href="https://developer.apple.com/documentation/quartzcore/cadisplaylink">Timer</a> you can line up one or multiple tasks in the future. You can specify if the timer needs to repeat.</p><pre><code><span class="keyword">let</span> timer = <span class="type">Timer</span>.<span class="call">scheduledTimer</span>(withTimeInterval: <span class="number">1.0</span>, repeats: <span class="keyword">true</span>) { timer <span class="keyword">in</span>
  <span class="call">print</span>(<span class="string">"1 second passed"</span>)
}
</code></pre><p>In the example above timer will fire every 1 second indefinitely.</p><p>To stop the timer you need to invalidate it.</p><pre><code>timer.<span class="call">invalidate</span>()
</code></pre><p>Timers are fired on the main thread. If the app is UI heavy timers won’t fire. To fix that you can: - attach to non-default <code>RunLoop</code> mode like common mode - it will allow a timer to fire even UI (main thread) is busy</p><pre><code><span class="type">RunLoop</span>.<span class="property">current</span>.<span class="call">add</span>(timer, forMode: .<span class="dotAccess">common</span>)
</code></pre><p>OR - you can synchronize with your screen updates with <code>CADisplayLink</code>.</p><h2>What is CADisplayLink?</h2><p><code>CADisplayLink</code> is a special flavor of Timer that lets your apps run a piece of code every time right after the screen has refreshed. Usually, it is 60 frames per second, but in selective devices like new iPads, it is 120 frames per second.</p><p>It is a great way to create smooth animations and calculate the next frame. This way you have a perfect timing between the frames unlike the classical <code>Timer</code> which is not guaranteed to fire on the exact time when the screen is refreshing.</p><pre><code><span class="keyword">class</span> DisplayLink {
  <span class="keyword">@objc func</span> displayRefreshed(displayLink: <span class="type">CADisplayLink</span>) {
    <span class="call">print</span>(displayLink.<span class="property">timestamp</span>)
  }

<span class="keyword">init</span>() {
  <span class="keyword">let</span> displayLink = <span class="type">CADisplayLink</span>(target: <span class="keyword">self</span>, selector: <span class="keyword">#selector</span>(<span class="call">displayRefreshed</span>(displayLink:)))
    displayLink.<span class="call">add</span>(to: .<span class="dotAccess">main</span>, forMode: .<span class="dotAccess">default</span>)
  }
}
</code></pre><p>When you create a <code>DisplayLink</code> it should be linked to an object and specified an <code>objc</code> function as a selector. This function will be fired as soon as redraw on the screen happens. We can see it by printing out the timestamp.</p><pre><code class="language-no-highlight">  ...
  93095.013681187
  93095.11224511401
  93095.12891178101
  93095.145578448
  93095.162245115
  93095.178911782
  93095.19557844901
  93095.21224511601
  ...
</code></pre><p><code>CADisplayLink</code> has a property <code>preferredFramesPerSecond</code> that lets you specify a callback rate calculated in frames per second. It means you can specify your refresh rate when you want the timer to fire. It is a great way if you don’t need to execute your code every time screen refreshes.</p><h2>Timer vs CADisplayLink</h2><p><code>Timer</code> and <code>CADisplayLink</code> both are ways to fire piece of code with an interval. These two approaches are different.</p><p><code>Timer</code> is useful when you just want to execute something let’s say every 5 seconds without it being tied to screen redrawing.</p><p><code>CADisplayLink</code> is tied to screen refresh rate which is either 60 or 120 frames per second. It is fired right after screen redraws and you have maximum amount of time to execute the code before the next screen refresh. This approach shines if you need to create seamless animations or it can be useful in game development where you can’t avoid any screen refresh drops.</p><h2>TL;DR</h2><p>We all might know <code>NSTimer</code> (or just <code>Timer</code>) which is good for executing piece of code after an interval with or without repeating it.</p><p>In some cases it’s worth to consider <code>CADisplayLink</code> especially if you want to work with animations and get most of the time between screen redraws itself.</p><h2>Links</h2><ul><li><a href="https://developer.apple.com/documentation/foundation/nstimer?language=objc">NSTimer official documentation</a></li><li><a href="https://developer.apple.com/documentation/quartzcore/cadisplaylink">CADisplayLink official documentation</a></li><li><a href="https://www.raywenderlich.com/113835-ios-timer-tutorial">Timer tutorial</a></li><li><a href="https://www.hackingwithswift.com/articles/117/the-ultimate-guide-to-timer">How to use Timer</a></li><li><a href="https://www.hackingwithswift.com/example-code/system/how-to-synchronize-code-to-drawing-using-cadisplaylink">How to use CADisplayLink</a></li><li><a href="https://medium.com/@dmitryivanov_54099/cadisplaylink-and-its-applications-bfafb760d738?source=linkShare-edb1354ca2c4-1583337923">In depth article about CADisplayLink</a></li><li><a href="https://stackoverflow.com/questions/30955847/ios-animation-cadisplaylink-vs-cashapelayer">Discussion about CADisplayLink and animations</a></li></ul></div></div></section></div><footer class="footer">Copyright © Kristaps Grinbergs. 2020</footer></body></html>
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Kristaps Grinbergs"/><link rel="canonical" href="https://kristaps.me/blog/animating-shapes-in-ios"/><meta name="twitter:url" content="https://kristaps.me/blog/animating-shapes-in-ios"/><meta name="og:url" content="https://kristaps.me/blog/animating-shapes-in-ios"/><title>Animating shapes in iOS | Kristaps Grinbergs</title><meta name="twitter:title" content="Animating shapes in iOS | Kristaps Grinbergs"/><meta name="og:title" content="Animating shapes in iOS | Kristaps Grinbergs"/><meta name="description" content="Animating a UIBezierPath drawing is a pretty trivial task. But how to animate shape morphing, i.e. make one shape change into another? (For instance, morphing a triangle into a square.) To accomplish this, we need to use CAShapeLayer and animate its properties using Core Animation capabilities."/><meta name="twitter:description" content="Animating a UIBezierPath drawing is a pretty trivial task. But how to animate shape morphing, i.e. make one shape change into another? (For instance, morphing a triangle into a square.) To accomplish this, we need to use CAShapeLayer and animate its properties using Core Animation capabilities."/><meta name="og:description" content="Animating a UIBezierPath drawing is a pretty trivial task. But how to animate shape morphing, i.e. make one shape change into another? (For instance, morphing a triangle into a square.) To accomplish this, we need to use CAShapeLayer and animate its properties using Core Animation capabilities."/><meta name="og:site_name" content="Kristaps Grinbergs - iOS and Apple technology developer. Startup founder. Conference speaker."/><meta name="og:title" content="Kristaps Grinbergs - iOS and Apple technology developer. Startup founder. Conference speaker."/><meta name="og:description" content="Kristaps Grinbergs - iOS and Apple technology developer. Startup founder. Conference speaker."/><meta name="og:image" content="linkedin.png"/><meta name="og:type" content="website"/><meta name="og:url" content="https://kristaps.me"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@fassko"/><meta name="twitter:title" content="Kristaps Grinbergs"/><meta name="twitter:description" content="Kristaps Grinbergs - iOS and Apple technology developer. Startup founder. Conference speaker."/><meta name="twitter:image" content="fb-og.png"/><link href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet"/><link rel="apple-touch-icon-precomposed" sizes="120x120" href="apple-touch-icon-120x120.png"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Kristaps Grinbergs"/></head><body><header class="header"><div class="header-wrapper"><div class="main-title"><a href="/">Kristaps Grinbergs</a></div><nav class="nav-container"><nav><ul class="nav"><li class="nav-item"><a href="/">home</a></li><li class="nav-item"><a href="/blog">blog</a></li><li class="nav-item"><a href="/talks">talks</a></li><li class="nav-item"><a href="/about">about</a></li></ul></nav></nav></div></header><div class="wrapper"><section class="blog-list"><div class="blog-item"><h1 class="blog-title">Animating shapes in iOS</h1><div class="blog-date">12 Feb 2019</div><div class="blog-content"><p>Animating a <code>UIBezierPath</code> drawing is a pretty trivial task. But how to animate shape morphing, i.e. make one shape change into another? (For instance, morphing a triangle into a square.) To accomplish this, we need to use <code>CAShapeLayer</code> and animate its properties using Core Animation capabilities.</p><p>First things first, let’s see which properties of <code>CAShapeLayer</code> can be animated with Core Graphics:</p><ul><li>Path</li><li>Fill color</li><li>Line dash phase</li><li>Line width</li><li>Miter limit</li><li>Stroke color</li><li>Stroke start and end.</li></ul><h2>Shape morphing</h2><p>To animate shape morphing, we need to change the <code>path</code> property. Keep in mind that both shapes need to have the same number of points that comprise them. Otherwise, the animation would end up looking clunky and unnatural.</p><img src="/assets/img/ugly-animation-from-square-to-triangle.gif" alt="Ugly animation from square to triangle"/><p>Even <a href="https://developer.apple.com/documentation/quartzcore/cashapelayer/1521904-path?language=objc">Apple’s official documentation</a> is warning us about that.</p><blockquote><p>Paths will interpolate as a linear blend of the "on-line" points; ”off-line” points may be interpolated non-linearly (e.g. to preserve continuity of the curve's derivative). If the two paths have a different number of control points or segments the results are undefined. If the path extends outside the layer bounds it will not automatically be clipped to the layer, only if the normal layer masking rules cause that.</p></blockquote><p>If we have same amount of points for both paths we can achieve much nicer animation.</p><img src="/assets/img/nice-animation-from-square-to-triangle.gif" alt="Nice animation from square to triangle"/><h2>Combining multiple animations</h2><p>The next step is to combine multiple <code>CGPath</code> animations together. To accomplish this, we can use <code>CAAnimationGroup</code>, which allows multiple animations to be grouped and run concurrently.</p><p>Be aware that you need to set correct <code>beginTime</code> for each animation so that they would start one after another. Animation properties like <code>duration</code>, <code>autoReverses</code>, <code>repeatCount</code> and others need to be set on the animation group object.</p><pre><code><span class="keyword">let</span> animationGroup = <span class="type">CAAnimationGroup</span>()
animationGroup.<span class="property">animations</span> = [...]
animationGroup.<span class="property">autoreverses</span> = <span class="keyword">true</span>
animationGroup.<span class="property">repeatCount</span> = .<span class="dotAccess">greatestFiniteMagnitude</span>
animationGroup.<span class="property">duration</span> = <span class="number">2.0</span>

</code></pre><img src="/assets/img/animation-multiple-shapes.gif" alt="Animation with multiple shapes"/><h2>TL;DR</h2><p><code>CAAnimationGroup</code> is a powerful feature that allows for several uses, from Core Animation to grouping multiple <code>CABasicAnimation</code>s together. If you want to animate from one path to another, be aware that <em>from</em> and <em>to</em> paths should have the same amount of points. Otherwise, the animation would look off because the animation algorithms can’t interpolate these points correctly.</p><h2>Links</h2><ul><li><a href="https://developer.apple.com/documentation/quartzcore/cashapelayer/1521904-path">Apple's CAShapeLayer path documentation</a></li><li><a href="https://calayer.com/core-animation/2017/12/25/cashapelayer-in-depth-part-ii.html">CAShapeLayer in Depth</a></li></ul></div></div></section></div><footer class="footer">Copyright © Kristaps Grinbergs. 2020</footer></body></html>
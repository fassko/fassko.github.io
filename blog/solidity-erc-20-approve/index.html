<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Kristaps Grinbergs"/><link rel="canonical" href="https://kristaps.me/blog/solidity-erc-20-approve"/><meta name="twitter:url" content="https://kristaps.me/blog/solidity-erc-20-approve"/><meta name="og:url" content="https://kristaps.me/blog/solidity-erc-20-approve"/><title>Understanding approve() in ERC-20: Why It Matters and How to Use It Safely | Kristaps Grinbergs</title><meta name="twitter:title" content="Understanding approve() in ERC-20: Why It Matters and How to Use It Safely | Kristaps Grinbergs"/><meta name="og:title" content="Understanding approve() in ERC-20: Why It Matters and How to Use It Safely | Kristaps Grinbergs"/><meta name="description" content="This post takes a closer look at the `approve()` function in the ERC-20 token standard. While commonly used in DeFi applications, it introduces a huge risk if not handled correctly. Learn how to use it safely and avoid known vulnerabilities."/><meta name="twitter:description" content="This post takes a closer look at the `approve()` function in the ERC-20 token standard. While commonly used in DeFi applications, it introduces a huge risk if not handled correctly. Learn how to use it safely and avoid known vulnerabilities."/><meta name="og:description" content="This post takes a closer look at the `approve()` function in the ERC-20 token standard. While commonly used in DeFi applications, it introduces a huge risk if not handled correctly. Learn how to use it safely and avoid known vulnerabilities."/><meta name="og:site_name" content="Kristaps Grinbergs - Blockchain, mobile and fullstack developer. Startup founder. Conference speaker. Mentor. Passionate about building products, sustainability and Web 3.0"/><meta name="og:title" content="Kristaps Grinbergs - Blockchain, mobile and fullstack developer. Startup founder. Conference speaker. Mentor. Passionate about building products, sustainability and Web 3.0"/><meta name="og:description" content="Kristaps Grinbergs - Blockchain, mobile and fullstack developer. Startup founder. Conference speaker. Mentor. Passionate about building products, sustainability and Web 3.0"/><meta name="og:image" content="https://kristaps.me/og-image.png"/><meta name="og:image:secure_url" content="https://kristaps.me/og-image.png"/><meta name="og:type" content="website"/><meta name="og:url" content="https://kristaps.me"/><meta name="og:image:secure_url" content="https://kristaps.me/og-image.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@fassko"/><meta name="twitter:title" content="Kristaps Grinbergs"/><meta name="twitter:description" content="Kristaps Grinbergs - Blockchain, mobile and fullstack developer. Startup founder. Conference speaker. Mentor. Passionate about building products, sustainability and Web 3.0"/><meta name="twitter:image" content="fb-og.png"/><link href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet"/><link rel="apple-touch-icon-precomposed" sizes="120x120" href="apple-touch-icon-120x120.png"/><script async src="https://www.googletagmanager.com/gtag/js?id=G-HBCE3H3QVL"></script><script src="/scripts/ga.js"></script><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Kristaps Grinbergs"/></head><body><header class="header"><div class="header-wrapper"><div class="main-title"><a href="/">Kristaps Grinbergs</a></div><nav class="nav-container"><nav><ul class="nav"><li class="nav-item"><a href="/">home</a></li><li class="nav-item"><a href="/blog">blog</a></li><li class="nav-item"><a href="/talks">talks</a></li><li class="nav-item"><a href="/about">about</a></li></ul></nav></nav></div></header><div class="wrapper"><section class="blog-list"><div class="blog-item"><h1><a class="blog-title" href="/blog/solidity-erc-20-approve">Understanding approve() in ERC-20: Why It Matters and How to Use It Safely</a></h1><div class="blog-date"><ul class="blog-tags"><li><a href="/tags/solidity">Solidity</a></li><li><a href="/tags/web3">web3</a></li><li><a href="/tags/erc20">ERC-20</a></li></ul>Jul 5, 2025</div><div class="blog-content"><p>In a <a href="/blog/solidity-erc-20/">previous post</a>, I gave a quick overview of ERC-20 — the fungible token standard used across EVM-compatible chains. Like how one dollar bill is interchangeable with another, ERC-20 tokens are designed to be equal in value and function.</p><p>Today, I want to dig deeper into one function in this standard that often goes unnoticed - but is critical for interacting with dApps and smart contracts: <code>approve()</code>.</p><h2>What <code>approve()</code> does?</h2><p>The <code>approve(address spender, uint256 amount)</code> function lets the token holder (caller) authorize another address (the spender) to spend tokens on their behalf — up to a defined limit.</p><p>This is essential when interacting with DeFi protocols, DEXes like Uniswap, or any smart contract that requires moving tokens from your wallet. Instead of transferring tokens directly, you first give the smart contract permission to pull tokens from your balance when needed.</p><pre><code><span class="type">IERC20</span>(token).<span class="call">approve</span>(spender, amount);
</code></pre><h2>Why You Should Care: Security Implications</h2><p>The naive implementation of approve() can be risky.</p><p>Let's say you initially approve 100 tokens, then later decide to reduce it to 50. If you call <code>approve(spender, 50)</code>, there is a chance that the spender sees both approvals before the new one takes effect — and spends both amounts.</p><p>This race condition is well-documented and can be exploited. See the issue on <a href="https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729">GitHub</a>.</p><p>The best practice is to first set the allowance to 0 and only then set it to the desired value.</p><pre><code>token.<span class="call">approve</span>(spender, <span class="number">0</span>);
token.<span class="call">approve</span>(spender, newAmount);
</code></pre><p>You can also use the OpenZeppelin's <code>SafeERC20</code> library with methods like <code>safeApprove()</code>, <code>safeIncreaseAllowance()</code>, and <code>safeDecreaseAllowance()</code> instead of manually calling <code>approve()</code>. Looking at this library is outside the scope of this blog post.</p><h2>TL;DR</h2><p>The <code>approve()</code> function of the ERC-20 standard permits a smart contract (or another address) to spend your tokens. It is a key part of token transfers in DeFi applications. Be careful and always reset to 0 before updating allowances to avoid race conditions.</p><p>The ERC-20 standard may seem simple, but subtle details like this one can expose users to a real risk of losing money.</p><h2>Links</h2><ul><li><a href="https://github.com/fassko/erc-20-approve-attack">Sample code</a></li></ul><ul><li><a href="https://eips.ethereum.org/EIPS/eip-20">EIP-20: Token Standard</a></li><li><a href="https://ethereum.org/en/developers/docs/standards/tokens/erc-20/">ERC-20 - Ethereum documentation</a></li><li><a href="https://docs.openzeppelin.com/contracts/4.x/erc20">ERC20 - OpenZeppelin documentation</a></li><li><a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/ERC20.sol">ERC20 - OpenZeppelin implementation</a></li></ul></div></div></section></div><footer class="footer"><p>Copyright © Kristaps Grinbergs. 2025.</p><p><a href="https://twitter.com/fassko" target="_blank">Twitter</a>•<a href="/feed.rss">RSS</a>•<a href="/about">Contact</a></p></footer></body></html>
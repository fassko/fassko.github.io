<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Kristaps Grinbergs"/><link rel="canonical" href="https://kristaps.me/blog/swiftui-select-image-with-phpickerviewcontroller"/><meta name="twitter:url" content="https://kristaps.me/blog/swiftui-select-image-with-phpickerviewcontroller"/><meta name="og:url" content="https://kristaps.me/blog/swiftui-select-image-with-phpickerviewcontroller"/><title>How to select images using PHPickerViewController with SwiftUI | Kristaps Grinbergs</title><meta name="twitter:title" content="How to select images using PHPickerViewController with SwiftUI | Kristaps Grinbergs"/><meta name="og:title" content="How to select images using PHPickerViewController with SwiftUI | Kristaps Grinbergs"/><meta name="description" content="Selecting images from our iPhone library is needed when changing a profile picture, posting an update, or sharing the photo of your pet. In this post, we are going to look into how to use `PHPickerViewController` with SwiftUI. Apple announced this view controller at WWDC2020."/><meta name="twitter:description" content="Selecting images from our iPhone library is needed when changing a profile picture, posting an update, or sharing the photo of your pet. In this post, we are going to look into how to use `PHPickerViewController` with SwiftUI. Apple announced this view controller at WWDC2020."/><meta name="og:description" content="Selecting images from our iPhone library is needed when changing a profile picture, posting an update, or sharing the photo of your pet. In this post, we are going to look into how to use `PHPickerViewController` with SwiftUI. Apple announced this view controller at WWDC2020."/><meta name="og:site_name" content="Kristaps Grinbergs - Blockchain, mobile and fullstack developer. Startup founder. Conference speaker. Mentor. Passionate about building products, sustainability and Web 3.0"/><meta name="og:title" content="Kristaps Grinbergs - Blockchain, mobile and fullstack developer. Startup founder. Conference speaker. Mentor. Passionate about building products, sustainability and Web 3.0"/><meta name="og:description" content="Kristaps Grinbergs - Blockchain, mobile and fullstack developer. Startup founder. Conference speaker. Mentor. Passionate about building products, sustainability and Web 3.0"/><meta name="og:image" content="https://kristaps.me/og-image.png"/><meta name="og:image:secure_url" content="https://kristaps.me/og-image.png"/><meta name="og:type" content="website"/><meta name="og:url" content="https://kristaps.me"/><meta name="og:image:secure_url" content="https://kristaps.me/og-image.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@fassko"/><meta name="twitter:title" content="Kristaps Grinbergs"/><meta name="twitter:description" content="Kristaps Grinbergs - Blockchain, mobile and fullstack developer. Startup founder. Conference speaker. Mentor. Passionate about building products, sustainability and Web 3.0"/><meta name="twitter:image" content="fb-og.png"/><link href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet"/><link rel="apple-touch-icon-precomposed" sizes="120x120" href="apple-touch-icon-120x120.png"/><script async src="https://www.googletagmanager.com/gtag/js?id=G-HBCE3H3QVL"></script><script src="/scripts/ga.js"></script><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Kristaps Grinbergs"/></head><body><header class="header"><div class="header-wrapper"><div class="main-title"><a href="/">Kristaps Grinbergs</a></div><nav class="nav-container"><nav><ul class="nav"><li class="nav-item"><a href="/">home</a></li><li class="nav-item"><a href="/blog">blog</a></li><li class="nav-item"><a href="/talks">talks</a></li><li class="nav-item"><a href="/about">about</a></li></ul></nav></nav></div></header><div class="wrapper"><section class="blog-list"><div class="blog-item"><h1><a class="blog-title" href="/blog/swiftui-select-image-with-phpickerviewcontroller">How to select images using PHPickerViewController with SwiftUI</a></h1><div class="blog-date"><ul class="blog-tags"><li><a href="/tags/swift">swift</a></li><li><a href="/tags/apple">apple</a></li><li><a href="/tags/ios">ios</a></li><li><a href="/tags/swiftui">swiftui</a></li><li><a href="/tags/images">images</a></li></ul>Jan 9, 2021</div><div class="blog-content"><p>Selecting images from our iPhone library is needed when changing a profile picture, posting an update, or sharing the photo of your pet. In this post, we are going to look into how to use <code>PHPickerViewController</code> with SwiftUI. Apple announced this view controller at <a href="https://developer.apple.com/wwdc20/">WWDC2020</a>.</p><h2>What is PHPickerViewController?</h2><p><code>PHPickerViewController</code> is a view controller that gives way for our app users to pick assets from their photo library. It provides a well-known user interface, and we don’t need to bother about building that.</p><p>One nicety that comes with this approach is that we don’t need to worry about adding information to access our user’s photo library in <code>Info.plist</code> file. Users can decide to allow access either to all photo library or selectively grant access to particular photos. That solves privacy concerns where apps could read the whole library and even <a href="https://krausefx.com/blog/ios-privacy-detectlocation-an-easy-way-to-access-the-users-ios-location-data-without-actually-having-access">track people</a>.</p><h3>Creating a <code>PHPickerViewController</code></h3><p>To create a <code>PHPickerViewController</code> we need to initialize it by passing configuration, which is an instance of <code>PHPickerConfiguration</code>. For the configuration, we need to specify what type of pictures we want and set the selection limit.</p><p>For the <code>PHPickerViewController</code> itself, we set the delegate that needs to implement <code>PHPickerViewControllerDelegate</code> protocol. It has just one method that gives a signal when our user has selected photos.</p><h2>Integrate with SwiftUI</h2><p>To use the <code>PHPickerViewController</code> in SwiftUI apps, we need to use the <code>UIViewControllerRepresentable</code> to represent an UIKit view controller. Let’s go over all the steps required in doing that.</p><h3>Setting up the UIKit view controller</h3><p><code>UIViewControllerRepresentable</code> is a protocol and requires to implement two methods:</p><ul><li><code>makeUIViewController</code> - create and configure the view controller;</li><li><code>updateUIViewControoler</code> - update the state of the view controller.</li></ul><p>We are going to create and configure the <code>PHPickerViewController</code> in the <code>makeUIViewController</code> method. We don’t need to update it, so we can leave the <code>updateUIViewControoler</code> empty.</p><pre><code><span class="keyword">struct</span> PhotoPicker: <span class="type">UIViewControllerRepresentable</span> {
  <span class="keyword">@Binding var</span> pickerResult: [<span class="type">UIImage</span>] <span class="comment">// pass images back to the SwiftUI view</span>
  <span class="keyword">@Binding var</span> isPresented: <span class="type">Bool</span> <span class="comment">// close the modal view</span>
  
  <span class="keyword">func</span> makeUIViewController(context: <span class="type">Context</span>) -&gt; <span class="keyword">some</span> <span class="type">UIViewController</span> {
    <span class="keyword">var</span> configuration = <span class="type">PHPickerConfiguration</span>(photoLibrary: <span class="type">PHPhotoLibrary</span>.<span class="call">shared</span>())
    configuration.<span class="property">filter</span> = .<span class="dotAccess">images</span> <span class="comment">// filter only to images</span>
    configuration.<span class="property">selectionLimit</span> = <span class="number">0</span> <span class="comment">// ignore limit</span>
    
    <span class="keyword">let</span> photoPickerViewController = <span class="type">PHPickerViewController</span>(configuration: configuration)
    photoPickerViewController.<span class="property">delegate</span> = context.<span class="property">coordinator</span> <span class="comment">// Use Coordinator for delegation</span>
    <span class="keyword">return</span> photoPickerViewController
  }
  
  <span class="keyword">func</span> updateUIViewController(<span class="keyword">_</span> uiViewController: <span class="type">UIViewControllerType</span>, context: <span class="type">Context</span>) { }
}
</code></pre><h3>Coordinator</h3><p>Now we can present the <code>PHPickerViewController</code>, but how can we transfer back the selected images? We need to use the <code>makeCoordinator</code> method and create the <code>Coordinator</code> class that implements the <code>PHPickerViewControllerDelegate</code> protocol. It is a thoughtful approach to how the SwiftUI can communicate with the UIKit delegation pattern idea.</p><pre><code><span class="keyword">struct</span> PhotoPicker: <span class="type">UIViewControllerRepresentable</span> {

  <span class="comment">// ...</span>

  <span class="keyword">func</span> makeCoordinator() -&gt; <span class="type">Coordinator</span> {
    <span class="type">Coordinator</span>(<span class="keyword">self</span>)
  }
  
  <span class="comment">// Create the Coordinator, in this case it is a way to communicate with the PHPickerViewController</span>
  <span class="keyword">class</span> Coordinator: <span class="type">PHPickerViewControllerDelegate</span> {
    <span class="keyword">private let</span> parent: <span class="type">PhotoPicker</span>
    
    <span class="keyword">init</span>(<span class="keyword">_</span> parent: <span class="type">PhotoPicker</span>) {
      <span class="keyword">self</span>.<span class="property">parent</span> = parent
    }
    
    <span class="keyword">func</span> picker(<span class="keyword">_</span> picker: <span class="type">PHPickerViewController</span>, didFinishPicking results: [<span class="type">PHPickerResult</span>]) {
    }
  }
}
</code></pre><h2>Using UIKit with SwiftUI</h2><p>Let’s put it all together. We need to create a SwiftUI view to present the photo picker view and present it as a modal. You can read more about how to display a modal view in SwiftUI in my <a href="/blog/swiftui-modal-view/">previous post</a>.</p><pre><code>.<span class="call">sheet</span>(isPresented: <span class="property">$photoPickerIsPresented</span>) {
  <span class="comment">// Present the photo picker view modally</span>
  <span class="type">PhotoPicker</span>(pickerResult: <span class="property">$pickerResult</span>,
              isPresented: <span class="property">$photoPickerIsPresented</span>)
}
</code></pre><h3>Passing data from UIKit to SwiftUI</h3><p>To get photos of what users have selected, let’s use <code>@State</code> variable and pass it to the <code>PhotoPicker</code> view using <code>@Binding</code> <a href="https://swiftuipropertywrappers.com/#binding">property wrapper</a>.</p><p>Now we can fully complete the <code>PHPickerViewControllerDelegate</code> protocol for our <code>Coordinator</code> class.</p><pre><code><span class="keyword">func</span> picker(<span class="keyword">_</span> picker: <span class="type">PHPickerViewController</span>, didFinishPicking results: [<span class="type">PHPickerResult</span>]) {
  parent.<span class="property">pickerResult</span>.<span class="call">removeAll</span>() <span class="comment">// remove previous pictures from the main view
  
  // unpack the selected items</span>
  <span class="keyword">for</span> image <span class="keyword">in</span> results {
    <span class="keyword">if</span> image.<span class="property">itemProvider</span>.<span class="call">canLoadObject</span>(ofClass: <span class="type">UIImage</span>.<span class="keyword">self</span>) {
      image.<span class="property">itemProvider</span>.<span class="call">loadObject</span>(ofClass: <span class="type">UIImage</span>.<span class="keyword">self</span>) { [<span class="keyword">weak self</span>] newImage, error <span class="keyword">in
        if let</span> error = error {
          <span class="call">print</span>(<span class="string">"Can't load image</span> \(error.<span class="property">localizedDescription</span>)<span class="string">"</span>)
        } <span class="keyword">else if let</span> image = newImage <span class="keyword">as</span>? <span class="type">UIImage</span> {
          <span class="comment">// Add new image and pass it back to the main view</span>
          <span class="keyword">self</span>?.<span class="property">parent</span>.<span class="property">pickerResult</span>.<span class="call">append</span>(image)
        }
      }
    } <span class="keyword">else</span> {
      <span class="call">print</span>(<span class="string">"Can't load asset"</span>)
    }
  }
  
  <span class="comment">// close the modal view</span>
  parent.<span class="property">isPresented</span> = <span class="keyword">false</span>
}
</code></pre><p>What we are doing here is unpacking selected items from the photo library and set them to the parent’s <code>@Binding</code> variable. By doing so, we are transferring the data back to the main view.</p><h3>Present the selected images</h3><p>To present the picked photos, we can iterate over and show them in a <code>ScrollView</code>.</p><pre><code><span class="type">ScrollView</span> {
  <span class="type">ForEach</span>(pickerResult, id: \.<span class="keyword">self</span>) { uiImage <span class="keyword">in</span>
    <span class="type">ImageView</span>(uiImage: uiImage)
  }
}
</code></pre><p>An important fact is that the type of image is <code>UIImage</code>, but luckily SwiftUI provides a nice initializer for the <code>Image</code> view passing the <code>UIImage</code> type.</p><p>You can check out the full implementation <a href="https://github.com/fassko/PHPickerViewController-SwiftUI">here</a>.</p><h2>TL;DR</h2><p>Selecting images and using them in our apps is an essential feature in modern iOS applications. Apple announced in WWDC2020 a new way to do it in a more secure and granular way - <code>PHPickerViewController</code>. Note that it is available only from iOS14 and later versions.</p><p>To use the <code>PHPickerViewController</code> with SwiftUI, we need to implement the <code>UIViewControllerRepresentable</code> protocol. It allows communicating from and to UIKit view controllers flawlessly.</p><h2>Links</h2><ul><li><a href="https://github.com/fassko/PHPickerViewController-SwiftUI">Sample code</a></li></ul><ul><li><a href="https://developer.apple.com/documentation/photokit/phpickerviewcontroller">PHPickerViewController documentation</a></li><li><a href="https://krausefx.com/blog/ios-privacy-detectlocation-an-easy-way-to-access-the-users-ios-location-data-without-actually-having-access">iOS Privacy: detect.location - An easy way to access the user's iOS location data without actually having access</a></li><li><a href="https://www.kairadiagne.com/2020/11/04/adopting-the-new-photo-picker.html">Adopting the new PHPicker</a></li><li><a href="https://nemecek.be/blog/30/checking-out-the-new-phpickerviewcontroller-in-ios-14-to-select-photos-or-videos">Checking out the new PHPickerViewController in iOS 14</a></li><li><a href="https://ohmyswift.com/blog/2020/08/29/replacing-uiimagepickercontroller-with-phpickerviewcontroller/">Replacing UIImagePickerController with PHPickerViewController</a></li><li><a href="https://christianselig.com/2020/09/phpickerviewcontroller-efficiently/">Using PHPickerViewController Images in a Memory-Efficient Way</a></li><li><a href="https://codakuma.com/the-library-is-open/">Accessing the photo library in SwiftUI</a></li></ul></div></div></section></div><footer class="footer"><p>Copyright © Kristaps Grinbergs. 2025.</p><p><a href="https://twitter.com/fassko" target="_blank">Twitter</a>•<a href="/feed.rss">RSS</a>•<a href="/about">Contact</a></p></footer></body></html>
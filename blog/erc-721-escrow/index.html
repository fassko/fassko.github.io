<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Kristaps Grinbergs"/><link rel="canonical" href="https://kristaps.me/blog/erc-721-escrow"/><meta name="twitter:url" content="https://kristaps.me/blog/erc-721-escrow"/><meta name="og:url" content="https://kristaps.me/blog/erc-721-escrow"/><title>Understanding Escrow in ERC-721 NFT Smart Contracts | Kristaps Grinbergs</title><meta name="twitter:title" content="Understanding Escrow in ERC-721 NFT Smart Contracts | Kristaps Grinbergs"/><meta name="og:title" content="Understanding Escrow in ERC-721 NFT Smart Contracts | Kristaps Grinbergs"/><meta name="description" content="The ERC-721 standard helps make buying and selling unique digital items (NFTs) safe and reliable. It is crucial to secure transactions between two parties. That is where escrow services come in. They act like a safety net, holding an NFT until everyone agrees and all rules have been met. Let's explore how we can develop an escrow using the ERC-721 standard using OpenZeppelin implementation."/><meta name="twitter:description" content="The ERC-721 standard helps make buying and selling unique digital items (NFTs) safe and reliable. It is crucial to secure transactions between two parties. That is where escrow services come in. They act like a safety net, holding an NFT until everyone agrees and all rules have been met. Let's explore how we can develop an escrow using the ERC-721 standard using OpenZeppelin implementation."/><meta name="og:description" content="The ERC-721 standard helps make buying and selling unique digital items (NFTs) safe and reliable. It is crucial to secure transactions between two parties. That is where escrow services come in. They act like a safety net, holding an NFT until everyone agrees and all rules have been met. Let's explore how we can develop an escrow using the ERC-721 standard using OpenZeppelin implementation."/><meta name="og:site_name" content="Kristaps Grinbergs - Blockchain, mobile and fullstack developer. Startup founder. Conference speaker. Mentor. Passionate about building products, sustainability and Web 3.0"/><meta name="og:title" content="Kristaps Grinbergs - Blockchain, mobile and fullstack developer. Startup founder. Conference speaker. Mentor. Passionate about building products, sustainability and Web 3.0"/><meta name="og:description" content="Kristaps Grinbergs - Blockchain, mobile and fullstack developer. Startup founder. Conference speaker. Mentor. Passionate about building products, sustainability and Web 3.0"/><meta name="og:image" content="https://kristaps.me/og-image.png"/><meta name="og:image:secure_url" content="https://kristaps.me/og-image.png"/><meta name="og:type" content="website"/><meta name="og:url" content="https://kristaps.me"/><meta name="og:image:secure_url" content="https://kristaps.me/og-image.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@fassko"/><meta name="twitter:title" content="Kristaps Grinbergs"/><meta name="twitter:description" content="Kristaps Grinbergs - Blockchain, mobile and fullstack developer. Startup founder. Conference speaker. Mentor. Passionate about building products, sustainability and Web 3.0"/><meta name="twitter:image" content="fb-og.png"/><link href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet"/><link rel="apple-touch-icon-precomposed" sizes="120x120" href="apple-touch-icon-120x120.png"/><script async src="https://www.googletagmanager.com/gtag/js?id=G-HBCE3H3QVL"></script><script src="/scripts/ga.js"></script><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Kristaps Grinbergs"/></head><body><header class="header"><div class="header-wrapper"><div class="main-title"><a href="/">Kristaps Grinbergs</a></div><nav class="nav-container"><nav><ul class="nav"><li class="nav-item"><a href="/">home</a></li><li class="nav-item"><a href="/blog">blog</a></li><li class="nav-item"><a href="/talks">talks</a></li><li class="nav-item"><a href="/about">about</a></li></ul></nav></nav></div></header><div class="wrapper"><section class="blog-list"><div class="blog-item"><h1><a class="blog-title" href="/blog/erc-721-escrow">Understanding Escrow in ERC-721 NFT Smart Contracts</a></h1><div class="blog-date"><ul class="blog-tags"><li><a href="/tags/ethereum">ethereum</a></li><li><a href="/tags/solidity">solidity</a></li><li><a href="/tags/nft">nft</a></li></ul>Mar 28, 2024</div><div class="blog-content"><p>The ERC-721 standard helps make buying and selling unique digital items (NFTs) safe and reliable. It is crucial to secure transactions between two parties. That is where escrow services come in. They act like a safety net, holding an NFT until everyone agrees and all rules have been met. Let's explore how we can develop an escrow using the ERC-721 standard using OpenZeppelin implementation.</p><h2>Sending an NFT to an Escrow</h2><p>At first, the NFT asset holder needs to approve that a specific token can be used by someone else to transfer it. Only the owner of that token can execute this command.</p><p>With the implementation of OpenZeppelin ERC-721, we can call the <code>approve(address to, uint256 tokenId)</code> function to delegate it.</p><pre><code><span class="comment">// Send to ESCROW address</span>
function <span class="call">sendToESCROW</span>(address escrow, uint256 tokenId) <span class="keyword">public</span> {
  <span class="call">approve</span>(escrow, tokenId);
}
</code></pre><p>In the code above, when the owner of the <code>tokenId</code> calls this function, they delegate transfer functionality to the <code>escrow</code> address. Now the <code>escrow</code> account holder can transfer this NFT to another address.</p><p>We can get an approved address to check if the token has been delegated to another account. If it is a zero (<code>0x</code>) address, that means it has not been delegated.</p><pre><code><span class="comment">// Returns the ESCROW address
// 0x address means that this NFT has not been sent to ESCROW</span>
function <span class="call">isSentToESCROW</span>(uint256 tokenId) <span class="keyword">public</span> view <span class="call">returns</span>(address) {
  <span class="keyword">return</span> <span class="call">_getApproved</span>(tokenId);
}
</code></pre><h2>Removing from an Escrow</h2><p>If the owner of the NFT changes their mind and wants to remove the delegation, they can do so by setting the approval address to zero (<code>0x</code>) address. In Solidity language, there is no concept of null values. The default value of an <code>address</code> type is zero (<code>0x</code>).</p><pre><code><span class="comment">// Remove from ESCROW</span>
function <span class="call">removeFromESCROW</span>(uint256 tokenId) <span class="keyword">public</span> {
  <span class="call">approve</span>(<span class="call">address</span>(<span class="number">0</span>), tokenId);
}
</code></pre><h2>Execute Transfer from an Escrow</h2><p>Suppose the token has been delegated to an escrow. The escrow can transfer it from the current owner to a new one because it has the right to do it.</p><pre><code><span class="comment">// Transfer to new owner from ESCROW</span>
function <span class="call">transferFromEscrow</span>(uint256 tokenId, address from, address to) <span class="keyword">public</span> {
  <span class="call">safeTransferFrom</span>(from, to, tokenId);
}
</code></pre><p>The OpenZeppelin ERC-721 implementation has the function <code>safeTransferFrom(address from, address to, uint256 tokenId)</code> that transfers a specific NFT <code>tokenId</code> from one account <code>from</code> to another <code>to</code>. The token must be owned by the <code>from</code> address. The caller is the escrow, and it has the right to move ownership of this NFT.</p><h2>TL;DR</h2><p>The ERC-721 standard and OpenZeppelin's implementation allow safe and reliable buying and selling of NFTs with escrow services. We can send an NFT to an escrow, check if an NFT has been delegated to an escrow, and remove an NFT from escrow. The escrow account holder can execute a transfer to a new owner. Using escrow allows all the parties to agree when the transfer happens when all the rules have been met.</p><h2>Links</h2><ul><li><a href="https://gist.github.com/fassko/f244139e246091225ecfebc2e77984b7">Demo code</a></li></ul><ul><li><a href="https://eips.ethereum.org/EIPS/eip-721">ERC-721: Non-Fungible Token Standard</a></li><li><a href="https://docs.openzeppelin.com/contracts/2.x/api/token/erc721">OpenZeppelin - ERC 721</a></li></ul></div></div></section></div><footer class="footer"><p>Copyright © Kristaps Grinbergs. 2025.</p><p><a href="https://twitter.com/fassko" target="_blank">Twitter</a>•<a href="/feed.rss">RSS</a>•<a href="/about">Contact</a></p></footer></body></html>